# Baking Rack
[![Tests](https://github.com/dcunning/baking_rack/workflows/Tests/badge.svg)](https://github.com/dcunning/baking_rack/actions?query=workflow%3ATests)

Bake and Push static webpages generated by [a Rack application](https://github.com/rack/rack/.

![Baking Rack Logo](https://github.com/dcunning/baking_rack/blob/main/doc/logo.png?raw=true)

## Table of Contents

- [Why?](#why)
- [Getting Started](#getting-started)
- [Usage](#usage)
- [Contributing](#contributing)
- [Versioning](#versioning)
- [License](#license)

## Why?

### Why static webpages?

When paired with a good hosting service, static webpages are cheaper to host, easier to maintain, and harder to hack than dynamic ones because there are so many less moving parts.

### Why one more Ruby static webpage generator?

`BakingRack` is a narrowly-focused library, not an all-encompassing framework.

Jekyll, Middleman, Nanoc, and Bridgetown are frameworks that define how your site is organized. `BakingRack` isn't interested in that, just that your site is [a Rack app](https://github.com/rack/rack/) (protip: all those frameworks support Rack) in order to gather its static pages and publish them to a static webserver or CDN.

## Getting Started

Start by including `baking_rack` in your Gemfile:

```ruby
gem 'baking_rack'
```

Then run `bundle install`.

### If hosting on AWS S3

Add another gem to your Gemfile:

```ruby
gem "aws-sdk-s3", require: false
```

Then run the following commands if you want to terraform files for creating the AWS resources necessary for hosting on S3 and serving on CloudFront.


```bash
# Rails only
$ bin/rails g baking_rack:terraform:aws_s3 --bucket "my-bucket.com" --redirects "www.my-bucket.com,old-bucket.com"

# Non-Rails can use Rake via `require "baking_rack/rake"`
$ bundle exec rake baking_rack:terraform:aws_s3 BUCKET="my-bucket.com" REDIRECTS="www.my-bucket.com,old-bucket.com"
```

`redirects` (optional) are domain name(s) that will redirect to your actual website.

Then refer to the [Terraform AWS Usage docs](https://developer.hashicorp.com/terraform/tutorials/aws-get-started) (hint: `terraform init` `terraform apply`)

## Usage

Command line interface:

```bash
# compiles the static site into a single directory
$ rake baking_rack:build

# transfers the build directory's files to the static web hosting service.
$ rake baking_rack:deploy

# perform the build and deploy
$ rake baking_rack:publish
```

Library configuration:

```ruby
# Rails: config/initializers/baking_rack.rb
BakingRack.configure do |c|
  # Standard default for Rails application.
  # Need to be set for Sinatra and others.
  c.application = Rails.application

  # Rails will default this value to the `Rails.application.config.hosts.first`
  c.domain_name = "my-domain.com"

  # Define which routes are rendered during the bake step.
  c.static_routes do
    # Render this explicit path using your Rack app.
    get "/about.html"

    # Rails applications automatically expose the path helpers
    get root_path

    # Collect routes from static data
    BlogPost.find_each do |post|
      get post.path
    end

    # Expect statuses other than "200 OK"
    get "/404.html", status: :not_found
  end

  # Add a build step that reformats HTML files.
  c.middleware.use BakingRack::BeautifyHtml

  # Define where to deploy the static files during the push step.
  c.deployer = c.deployers.aws_s3(bucket: "my-bucket.com")
end
```

## Contributing

If you have problems, please create a [GitHub Issue](/.github/ISSUE_TEMPLATE/bug-report.md).

## Versioning

`baking_rack` follows Semantic Versioning 2.0 as defined at https://semver.org.

## License

This code is free to use under the terms of the MIT license.
